<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spectroscopy Simulation</title>
    <style>
        body {
            font-family: sans-serif;
            font-size: 15px;
            width: 700px;
            margin: 0 auto;
            text-align: center;
        }
        .checkbox-container {
            border: 5px outset black;
            background-color: lightblue;
            text-align: left;
            padding: 10px;
            margin: 10px;
            display: inline-block;
        }
        .control-bar {
            width: 100%;
            overflow: hidden;
        }
        ul {
            list-style: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <h3>Spectroscopy Simulation</h3>
    <canvas id="spectrumDisplay" width="700" height="440"></canvas>
    <div class="control-bar">
        <div class="checkbox-container" id="emissionControls">
            <strong>Show emission spectrum for:</strong>
            <!-- Checkboxes will be generated by JS -->
        </div>
        <div class="checkbox-container" id="absorptionControls">
            <strong>Show absorption spectrum for:</strong>
            <!-- Checkboxes will be generated by JS -->
        </div>
    </div>

    <script>
        class SpectroscopySimulator {
            constructor() {
                this.canvas = document.getElementById("spectrumDisplay");
                this.ctx = this.canvas.getContext("2d");
                this.xBase = 50;
                this.yVisSpec = 150;
                this.yBase = 350;
                this.elements = this.initializeElements();
                this.emissionState = new Array(this.elements.length).fill(false);
                this.absorptionState = new Array(this.elements.length).fill(false);

                this.setupUI();
                this.initializeDisplay();
            }

            initializeElements() {
                return [
                    { name: "Hydrogen", wavelengths: [410.2, 434.0, 486.1, 656.3] },
                    { name: "Helium", wavelengths: [447.1, 471.3, 492.2, 501.6, 587.6, 667.8] },
                    { name: "Sodium", wavelengths: [439.3, 445.5, 449.1, 589, 589.6] },
                    { name: "Mercury", wavelengths: [404.7, 435.8, 546.1, 577, 579.1] },
                    { name: "Lithium", wavelengths: [468, 479, 548.4, 610.3, 670.8] },
                    { name: "Neon", wavelengths: [540.1, 585.2, 588.2, 603, 607.4, 616.4, 621.7, 626.6, 633.4, 638.3, 640.2, 650.6, 659.9, 692.9] }
                ];
            }

            setupUI() {
                const createCheckboxes = (containerId, type) => {
                    const container = document.getElementById(containerId);
                    this.elements.forEach((element, index) => {
                        const li = document.createElement("li");
                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.id = `${type}-${element.name}`;
                        checkbox.addEventListener("change", () => 
                            type === "emission" ? 
                            this.updateEmission(index) : 
                            this.updateAbsorption(index)
                        );
                        li.appendChild(checkbox);
                        li.appendChild(document.createTextNode(element.name));
                        container.appendChild(li);
                    });
                };
                createCheckboxes("emissionControls", "emission");
                createCheckboxes("absorptionControls", "absorption");
            }

            initializeDisplay() {
                this.ctx.fillStyle = "black";
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.drawAxis(this.yVisSpec, "Continuous spectrum, visible light", 50);
                this.drawAxis(this.yBase, "", this.yBase + 44);
                this.drawVisibleSpectrum();
            }

            drawAxis(yPos, title, titleY) {
                this.ctx.lineWidth = 2;
                this.ctx.strokeStyle = "white";
                this.ctx.font = "14pt Calibri";
                this.ctx.fillStyle = "white";

                this.ctx.beginPath();
                this.ctx.moveTo(this.xBase, yPos);
                this.ctx.lineTo(this.xBase + 600, yPos);
                this.ctx.stroke();

                for (let i = 0; i <= 6; i++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.xBase + i * 100, yPos);
                    this.ctx.lineTo(this.xBase + i * 100, yPos + 10);
                    this.ctx.stroke();
                    this.ctx.textAlign = "center";
                    this.ctx.fillText(400 + 50 * i, this.xBase + i * 100, yPos + 20);
                }

                this.ctx.font = "18pt Calibri";
                this.ctx.fillText("Wavelength (nm)", this.canvas.width / 2, yPos + 44);
                if (title) this.ctx.fillText(title, this.canvas.width / 2, titleY);
            }

            drawVisibleSpectrum() {
                this.ctx.fillStyle = "black";
                this.ctx.fillRect(this.xBase, this.yVisSpec, 600, -80);
                for (let i = 0; i <= 600; i++) {
                    const wavelength = 400 + 0.5 * i;
                    this.ctx.strokeStyle = this.getColorFromWavelength(wavelength);
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.xBase + i, this.yVisSpec);
                    this.ctx.lineTo(this.xBase + i, this.yVisSpec - 80);
                    this.ctx.stroke();
                }
            }

            updateEmission(index) {
                this.emissionState[index] = !this.emissionState[index];
                this.drawEmission();
            }

            updateAbsorption(index) {
                this.absorptionState[index] = !this.absorptionState[index];
                this.drawVisibleSpectrum();
                this.drawAbsorption();
            }

            drawEmission() {
                this.ctx.fillStyle = "black";
                this.ctx.fillRect(this.xBase, this.yBase, 600, -80);
                this.emissionState.forEach((active, i) => {
                    if (active) this.drawLines(this.elements[i].wavelengths, this.yBase, -80);
                });
            }

            drawAbsorption() {
                this.absorptionState.forEach((active, i) => {
                    if (active) this.drawLines(this.elements[i].wavelengths, this.yVisSpec, -80, "black");
                });
            }

            drawLines(wavelengths, yStart, height, color = null) {
                wavelengths.forEach(wl => {
                    this.ctx.strokeStyle = color || this.getColorFromWavelength(wl);
                    this.ctx.beginPath();
                    const x = this.xBase + 2 * (wl - 400);
                    this.ctx.moveTo(x, yStart - 2);
                    this.ctx.lineTo(x, yStart + height);
                    this.ctx.stroke();
                });
            }

            getColorFromWavelength(lambda) {
                const r = lambda <= 500 ? Math.floor(160 - 160 * (lambda - 400) / 100) :
                         lambda >= 558 && lambda < 590 ? Math.floor(255 - 255 * (590 - lambda) ** 2 / (32 * 32)) :
                         lambda >= 590 ? (lambda >= 650 ? Math.floor(255 - 2 * (lambda - 650)) : 255) : 0;

                const g = lambda > 460 && lambda < 500 ? Math.floor(255 - 255 * (500 - lambda) ** 2 / 1600) :
                         lambda >= 500 && lambda <= 570 ? 255 :
                         lambda > 570 && lambda <= 640 ? Math.floor(255 - 255 * (lambda - 570) ** 2 / (70 * 70)) : 0;

                const b = lambda < 460 ? 255 :
                         lambda >= 460 && lambda < 550 ? Math.floor(255 - 255 * (lambda - 460) ** 2 / (90 * 90)) : 0;

                return `#${[r, g, b].map(c => c.toString(16).padStart(2, "0")).join("")}`;
            }
        }

        // Initialize the simulation
        new SpectroscopySimulator();
    </script>
</body>
</html>
